# MMFI数据集VQ-VAE训练配置 - 方案2：Chamfer距离损失
# 适用于将骨架数据视为点云的几何形状重建

optimizer : {
  type: AdamW,
  kwargs: {
  lr : 0.00001,  # 降低学习率
  weight_decay : 0.00001
}}

scheduler: {
  type: CosLR,
  kwargs: {
    epochs: 200,  # 骨架数据需要更多epoch学习时序模式
    initial_epochs : 20,
    warming_up_init_lr: 0.00001
}}

# VQ-VAE特有参数 - 不需要温度退火
vq_params: {
  commitment_cost: 0.25,  # VQ-VAE的承诺损失权重
  codebook_size: 1024,    # 码本大小，适合骨架动作的离散表示
  embedding_dim: 256      # 嵌入向量维度
}

# KL权重调度（如果使用混合方法）
kldweight: {
  start : 0,
  target: 0.05,  # VQ-VAE的KL权重较小
  ntime: 50000
}

dataset : {
  train : { _base_: cfgs/dataset_configs/MMFI.yaml, 
            others: {subset: 'train'}},
  val : { _base_: cfgs/dataset_configs/MMFI.yaml, 
            others: {subset: 'val'}},
  test : { _base_: cfgs/dataset_configs/MMFI.yaml, 
            others: {subset: 'test'}}
}

model : {
  NAME: AdaptiveSkeletonDVAE,  # 使用自适应骨架DVAE
  latent_dim: 512,      # 潜在空间维度
  num_tokens: 1024,     # 码本大小 
  commitment_cost: 0.25, # VQ承诺损失权重
  loss_type: chamfer    # 方案2：使用Chamfer距离（与验证指标一致）
}

# 训练配置
total_bs : 32         # 骨架数据可以使用较大batch size
step_per_update : 1
max_epoch : 100       # 增加训练轮数

# 硬件和验证设置
use_gpu: true
val_freq: 10
save_freq: 20

# 日志和实验配置
experiment_name: "MMFI_skeleton_vqvae_chamfer"
log_dir: "logs/mmfi_vqvae_chamfer"
checkpoint_dir: "experiments/vqvae/MMFI_models"

# 损失权重配置
loss_weights: {
  recon_loss: 1.0,      # 重建损失
  vq_loss: 1.0,         # VQ损失
  action_loss: 0.3      # 动作分类损失（如果启用）
}

# 数据增强配置
data_augmentation: {
  enable: true,
  noise_std: 0.01,      # 添加小量噪声
  temporal_shift: true, # 时序偏移
  joint_dropout: 0.1    # 关节丢弃
}

# 评估配置
evaluation: {
  metrics: ["chamfer_l1", "chamfer_l2", "vq_loss", "codebook_usage", "perplexity"],
  save_reconstructions: true,
  save_codes: true
}

# 主要评估指标（用于模型选择）
consider_metric: CDL1  # 使用Chamfer距离L1作为主要指标

# 方案说明
loss_strategy: {
  name: "Chamfer Distance Shape Matching",
  description: "使用Chamfer距离关注整体几何形状一致性，与验证指标保持统一",
  advantages: [
    "与验证指标一致",
    "关注整体几何形状",
    "对点顺序不敏感",
    "适合形状匹配任务"
  ],
  use_cases: [
    "重视整体姿态形状",
    "与现有Point-BERT框架保持一致",
    "需要旋转不变性的任务"
  ]
}
