# GCN时空图卷积配置文件说明

## 文件概览

为GCN时空图卷积架构创建了以下配置文件：

### 1. 主要配置文件

#### `gcn_skeleton_tokenizer_25joints.yaml`
- **用途**: GCN架构的标准训练配置
- **特点**: 基于25关节点的时空图卷积
- **数据**: 原始NTU-RGB+D .skeleton文件
- **内存**: 中等优化（1000个训练文件）
- **适用**: 有充足内存的训练环境

```yaml
# 关键配置
total_bs: 8
max_files: 1000
num_tokens: 512
token_dim: 256
```

#### `gcn_skeleton_memory_optimized.yaml`
- **用途**: 内存受限环境的极致优化配置
- **特点**: 解决.skeleton文件内存占用问题
- **数据**: 仅使用100个训练文件
- **内存**: 极致优化（适合小内存环境）
- **适用**: 概念验证和内存受限场景

```yaml
# 关键配置
total_bs: 4
max_files: 100
num_tokens: 256
token_dim: 128
```

### 2. 数据集配置文件

#### `NTU_skeleton_raw.yaml`
- **用途**: 原始NTU-RGB+D骨架数据配置
- **特点**: 直接处理.skeleton文件
- **优势**: 无需720点密集化预处理
- **语义**: 3个解剖学分组

## 配置文件对比

### 与DGCNN配置的主要差异

| 特性 | DGCNN配置 | GCN配置 | 优势 |
|------|-----------|---------|------|
| 数据点数 | 720点 | 25点 | 29倍减少 |
| 数据来源 | H5增强数据 | 原始.skeleton | 直接处理 |
| 连接方式 | KNN | 解剖学连接 | 语义正确 |
| 分组策略 | 7个任务分组 | 3个语义分组 | 简化清晰 |
| 内存占用 | 高 | 低 | 显著优化 |

### 内存优化策略对比

| 策略 | 标准版本 | 内存优化版本 |
|------|----------|--------------|
| 训练文件数 | 1000 | 100 |
| 批次大小 | 8 | 4 |
| 码本大小 | 512 | 256 |
| Token维度 | 256 | 128 |
| 梯度累积 | 2 | 4 |

## 使用指南

### 1. 选择合适的配置

#### 标准训练环境（推荐）
```bash
# 使用标准GCN配置
python main.py --config cfgs/NTU_models/gcn_skeleton_tokenizer_25joints.yaml
```

#### 内存受限环境
```bash
# 使用内存优化配置
python main.py --config cfgs/NTU_models/gcn_skeleton_memory_optimized.yaml
```

#### 自定义训练脚本
```bash
# 使用专门的优化训练脚本
python models_skeleton/train_gcn_optimized.py --batch_size 4 --max_files 100
```

### 2. 渐进式扩展策略

1. **第一阶段**: 使用内存优化版本验证架构
   - 100个文件，快速收敛
   - 验证GCN架构可行性

2. **第二阶段**: 使用标准版本
   - 1000个文件，充分训练
   - 获得较好的性能基线

3. **第三阶段**: 扩展到全数据集
   - 实施数据预处理（.skeleton → HDF5）
   - 使用完整91,584个文件训练

### 3. 配置文件自定义

#### 调整文件数量
```yaml
# 在dataset配置中修改
max_files: 500  # 根据内存情况调整
```

#### 调整模型大小
```yaml
# 在model配置中修改
num_tokens: 256    # 码本大小
token_dim: 128     # Token维度
```

#### 调整训练参数
```yaml
# 在训练配置中修改
total_bs: 6        # 批次大小
max_epoch: 15      # 训练轮数
```

## 架构特点

### GCN的革命性优势

1. **计算效率**: 25点 vs 720点，29倍计算减少
2. **语义一致**: 基于解剖学连接，避免KNN偏离
3. **架构简洁**: 3个语义分组 vs 7个任务分组
4. **内存友好**: 直接处理原始数据，无需密集化

### 语义分组设计

```yaml
semantic_groups: {
  axial: [0, 1, 20, 2, 3],                      # 脊柱+头部 (5关节)
  upper_limbs: [4, 5, 6, 7, 21, 22, 8, 9, 10, 11, 23, 24],  # 双臂 (12关节)
  lower_limbs: [12, 13, 14, 15, 16, 17, 18, 19]  # 双腿 (8关节)
}
```

### 骨架连接定义

基于NTU RGB+D标准，包含24条解剖学连接：
- 头部脊柱连接: 4条边
- 左臂连接: 6条边  
- 右臂连接: 6条边
- 左腿连接: 4条边
- 右腿连接: 4条边

## 故障排除

### 内存不足问题
1. 使用`gcn_skeleton_memory_optimized.yaml`
2. 进一步减少`max_files`
3. 减小`batch_size`到2或1
4. 使用`num_workers: 0`

### 数据加载问题
1. 检查`DATA_PATH`是否正确
2. 确认.skeleton文件存在
3. 检查文件权限

### 训练收敛问题
1. 调整学习率
2. 增加训练轮数
3. 检查数据质量

这些配置文件提供了从概念验证到生产训练的完整路径，支持GCN架构的渐进式部署和优化。
